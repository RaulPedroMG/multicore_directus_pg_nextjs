{
  "version": "1.0",
  "name": "multicore-directus-nextjs",
  "description": "Multi-container application with Directus, Next.js, and PostgreSQL",
  "compose": {
    "files": [
      "database/docker-compose.yml",
      "directus/docker-compose.yml",
      "app/docker-compose.yml"
    ],
    "projectName": "multicore-directus",
    "startupOrder": ["database", "directus", "app"]
  },
  "environment": {
    "required": [
      "DB_USER",
      "DB_PASSWORD",
      "DB_NAME",
      "PGADMIN_DEFAULT_EMAIL",
      "PGADMIN_DEFAULT_PASSWORD",
      "DIRECTUS_KEY",
      "DIRECTUS_SECRET",
      "DIRECTUS_ADMIN_EMAIL",
      "DIRECTUS_ADMIN_PASSWORD",
      "DIRECTUS_PUBLIC_URL"
    ]
  },
  "ports": [
    { "container": "nextjs_app", "internal": 3000, "external": 3037 },
    { "container": "directus", "internal": 8055, "external": 8057 },
    { "container": "pgadmin", "internal": 80, "external": 5057 },
    { "container": "postgres", "internal": 5432, "external": 5437 }
  ],
  "healthcheck": {
    "endpoints": [
      {
        "name": "nextjs",
        "url": "http://localhost:3037",
        "expectedStatus": 200
      },
      {
        "name": "directus",
        "url": "http://localhost:8057/server/health",
        "expectedStatus": 200
      }
    ],
    "timeout": 30,
    "retries": 5
  },
  "volumes": [
    {
      "name": "postgres_data",
      "path": "/var/lib/postgresql/data",
      "service": "postgres"
    },
    {
      "name": "pgadmin_data",
      "path": "/var/lib/pgadmin",
      "service": "pgadmin"
    },
    {
      "name": "directus_uploads",
      "path": "/directus/uploads",
      "service": "directus"
    },
    {
      "name": "directus_extensions",
      "path": "/directus/extensions",
      "service": "directus"
    },
    { "name": "directus_data", "path": "/directus/data", "service": "directus" }
  ],
  "networking": {
    "createExternalNetwork": true,
    "externalNetworkName": "directus_network"
  },
  "domains": [
    {
      "container": "nextjs_app",
      "domain": "${APP_DOMAIN}",
      "internal_port": 3000,
      "path": "/"
    },
    {
      "container": "directus",
      "domain": "${DIRECTUS_DOMAIN}",
      "internal_port": 8055,
      "path": "/"
    }
  ]
}
